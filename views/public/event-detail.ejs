<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <title><%= event.title %></title>
    <link rel="stylesheet" href="/stylesheets/global.css">
    <link rel="stylesheet" href="/stylesheets/toast.css">
    <link rel="stylesheet" href="/stylesheets/eventDetail.css">
    <script src="/javascripts/toast" defer></script>
    <script src="/javascripts/registerForEvent.js" defer></script>
</head>
<body>
<div class="event-detail-container">

    <!-- Header -->
    <div class="event-detail-header">
        <h1 class="event-detail-title"><%= event.title %></h1>
        <p class="event-detail-subtitle">
            <%= new Date(event.startDate).toLocaleDateString('de-DE', {
                weekday: "long",
                year: "numeric",
                month: "long",
                day: "numeric"
            }) %>
        </p>
    </div>

    <!-- Content -->
    <div class="event-detail-content">
        <div class="event-detail-info">
            <!-- Ort -->
            <div class="event-detail-field">
                <span class="event-detail-label">Ort</span>
                <span class="event-detail-value"><%= event.location || 'Online' %></span>
            </div>
            <!-- Startzeit -->
            <div class="event-detail-field">
                <span class="event-detail-label">Startzeit</span>
                <span class="event-detail-value">
                    <%= new Date(event.startDate).toLocaleTimeString('de-DE', {
                        hour: "2-digit",
                        minute: "2-digit"
                    }) %> Uhr
                </span>
            </div>
            <!-- Endzeit -->
            <div class="event-detail-field">
                <span class="event-detail-label">Endzeit</span>
                <span class="event-detail-value">
                    <%= new Date(event.endDate).toLocaleTimeString('de-DE', {
                        hour: "2-digit",
                        minute: "2-digit"
                    }) %> Uhr
                </span>
            </div>
            <!-- Anmeldefrist -->
            <div class="event-detail-field">
                <span class="event-detail-label">Anmeldefrist</span>
                <span class="event-detail-value">
                    <%= new Date(event.registrationDeadline).toLocaleDateString('de-DE', {
                        weekday: "short",
                        day: "numeric",
                        month: "numeric",
                        year: "numeric",
                        hour: "2-digit",
                        minute: "2-digit"
                    }) %>
                </span>
            </div>
            <!-- Status -->
            <div class="event-detail-field">
                <span class="event-detail-label">Status</span>
                <span class="event-detail-value">
                    <% if(new Date() >= event.registrationDeadline && new Date() < event.startDate) { %>
                        <span class="event-detail-status-badge status-closed">Anmeldung geschlossen</span>
                    <% } else if(new Date() >= event.startDate && new Date() < event.endDate) { %>
                        <span class="event-detail-status-badge status-started">Veranstaltung läuft gerade</span>
                    <% } else if(new Date() > event.endDate) { %>
                        <span class="event-detail-status-badge status-past">Veranstaltung ist beendet</span>
                    <% } else if(new Date() < event.registrationDeadline) { %>
                        <span class="event-detail-status-badge status-open">Anmeldung offen</span>
                    <% } else { %>
                        <span class="event-detail-status-badge status-error">Unbekannter Status</span>
                    <% } %>
                </span>
            </div>

            <!-- schon Angemeldet -->
            <div class="event-detail-field">
                <span class="event-detail-label">Angemeldet</span>
                <span class="event-detail-value"><%= event.participants ? event.participants.length : 0 %> Personen</span>
            </div>
        </div>

        <% if(event.description) { %>
            <div class="event-detail-description">
                <%= event.description %>
            </div>
        <% } %>

        <% if(new Date() < event.registrationDeadline && new Date() < event.startDate ){ %>
            <div class="event-detail-registration">
                <h3 class="event-detail-registration-title">Jetzt anmelden</h3>

                <form id="registrationForm" data-event-id="<%= event.id %>">
                    <div class="event-detail-form">
                        <div class="event-detail-form-group">
                            <label for="firstName" class="event-detail-form-label">Vorname</label>
                            <input type="text" id="firstName" name="firstName" class="form-input" required>
                            <div id="firstNameError" class="error-message"></div>
                        </div>
                        <div class="event-detail-form-group">
                            <label for="lastName" class="event-detail-form-label">Nachname</label>
                            <input type="text" id="lastName" name="lastName" class="form-input" required>
                            <div id="lastNameError" class="error-message"></div>
                        </div>
                        <div class="event-detail-form-group">
                            <label for="email" class="event-detail-form-label">E-mail</label>
                            <input type="email" id="email" name="email" class="form-input" required>
                            <div id="emailError" class="error-message"></div>
                        </div>
                        <button type="submit" class="btn-primary event-detail-submit-button">Anmelden</button>
                    </div>
                </form>
            </div>
        <% } else if(new Date() >= event.registrationDeadline && new Date() < event.startDate) { %>
            <div class="event-detail-deadline-expired">
                Anmeldefrist ist abgelaufen. Anmeldung nicht mehr möglich.
            </div>
        <% } else if (new Date() >= event.startDate && new Date() < event.endDate) { %>
            <div class="event-detail-event-started">
                Event läuft gerade.
            </div>
        <% } else if(new Date() >= event.endDate){ %>
            <div class="event-detail-event-ended">
                Event ist beendet.
            </div>
        <% } %>

        <a href="/event" class="back-link">Zurück zur Event-Übersicht</a>
    </div>
</div>
<div id="toastContainer"></div>
</body>
</html>